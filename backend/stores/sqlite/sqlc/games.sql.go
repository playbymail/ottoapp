// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: games.sql

package sqlc

import (
	"context"
)

const getGame = `-- name: GetGame :one
SELECT game_id,
       description,
       setup_turn_year,
       setup_turn_month,
       setup_turn_no,
       is_active
FROM games
WHERE game_id = ?1
`

type GetGameRow struct {
	GameID         string
	Description    string
	SetupTurnYear  int64
	SetupTurnMonth int64
	SetupTurnNo    int64
	IsActive       bool
}

func (q *Queries) GetGame(ctx context.Context, gameID string) (GetGameRow, error) {
	row := q.db.QueryRowContext(ctx, getGame, gameID)
	var i GetGameRow
	err := row.Scan(
		&i.GameID,
		&i.Description,
		&i.SetupTurnYear,
		&i.SetupTurnMonth,
		&i.SetupTurnNo,
		&i.IsActive,
	)
	return i, err
}

const getGameUserClan = `-- name: GetGameUserClan :one
SELECT clan_id,
       game_id,
       user_id,
       clan,
       setup_turn_no,
       is_active
FROM clans
WHERE game_id = ?1
  AND user_id = ?2
`

type GetGameUserClanParams struct {
	GameID string
	UserID int64
}

type GetGameUserClanRow struct {
	ClanID      int64
	GameID      string
	UserID      int64
	Clan        int64
	SetupTurnNo int64
	IsActive    bool
}

func (q *Queries) GetGameUserClan(ctx context.Context, arg GetGameUserClanParams) (GetGameUserClanRow, error) {
	row := q.db.QueryRowContext(ctx, getGameUserClan, arg.GameID, arg.UserID)
	var i GetGameUserClanRow
	err := row.Scan(
		&i.ClanID,
		&i.GameID,
		&i.UserID,
		&i.Clan,
		&i.SetupTurnNo,
		&i.IsActive,
	)
	return i, err
}

const removeGameUserClan = `-- name: RemoveGameUserClan :exec
DELETE
FROM clans
WHERE game_id = ?1
  AND user_id = ?2
  AND clan_id = ?3
`

type RemoveGameUserClanParams struct {
	GameID string
	UserID int64
	ClanID int64
}

func (q *Queries) RemoveGameUserClan(ctx context.Context, arg RemoveGameUserClanParams) error {
	_, err := q.db.ExecContext(ctx, removeGameUserClan, arg.GameID, arg.UserID, arg.ClanID)
	return err
}

const upsertGame = `-- name: UpsertGame :one

INSERT INTO games (game_id,
                   description,
                   setup_turn_no,
                   setup_turn_year,
                   setup_turn_month,
                   is_active,
                   created_at,
                   updated_at)
VALUES (?1,
        ?2,
        ?3,
        ?4,
        ?5,
        ?6,
        ?7,
        ?8)
ON CONFLICT (game_id) DO UPDATE
    SET description      = excluded.description,
        setup_turn_no    = excluded.setup_turn_no,
        setup_turn_year  = excluded.setup_turn_year,
        setup_turn_month = excluded.setup_turn_month,
        is_active        = excluded.is_active,
        updated_at       = excluded.updated_at
RETURNING game_id
`

type UpsertGameParams struct {
	GameID         string
	Description    string
	SetupTurnNo    int64
	SetupTurnYear  int64
	SetupTurnMonth int64
	IsActive       bool
	CreatedAt      int64
	UpdatedAt      int64
}

// Copyright (c) 2025 Michael D Henderson. All rights reserved.
func (q *Queries) UpsertGame(ctx context.Context, arg UpsertGameParams) (string, error) {
	row := q.db.QueryRowContext(ctx, upsertGame,
		arg.GameID,
		arg.Description,
		arg.SetupTurnNo,
		arg.SetupTurnYear,
		arg.SetupTurnMonth,
		arg.IsActive,
		arg.CreatedAt,
		arg.UpdatedAt,
	)
	var game_id string
	err := row.Scan(&game_id)
	return game_id, err
}

const upsertGameUserClan = `-- name: UpsertGameUserClan :one
INSERT INTO clans (game_id, user_id, clan, setup_turn_no, created_at, updated_at)
VALUES (?1, ?2, ?3, ?4, ?5, ?6)
ON CONFLICT (user_id, game_id) DO UPDATE SET clan          = excluded.clan,
                                             setup_turn_no = excluded.setup_turn_no,
                                             updated_at    = excluded.updated_at
RETURNING clan_id
`

type UpsertGameUserClanParams struct {
	GameID      string
	UserID      int64
	Clan        int64
	SetupTurnNo int64
	CreatedAt   int64
	UpdatedAt   int64
}

// UpsertGameUserClan has two business rules
//
//	user can have at most one clan per game.
//	clan number can be used by at most one user per game.
//
// The upsert key is "user_id, game_id," preventing a user
// from claiming multiple clans in a game. If a user tries
// claiming an existing clan in a game, it will fail, not
// silently clobber another user's.
func (q *Queries) UpsertGameUserClan(ctx context.Context, arg UpsertGameUserClanParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, upsertGameUserClan,
		arg.GameID,
		arg.UserID,
		arg.Clan,
		arg.SetupTurnNo,
		arg.CreatedAt,
		arg.UpdatedAt,
	)
	var clan_id int64
	err := row.Scan(&clan_id)
	return clan_id, err
}
